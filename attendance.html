<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Attendance</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
    </head>
    <body data-page="attendance">
        <div class="banner container">
            <div class="navbar">
                <img src="logo.jpg" class="logo" alt="School Logo">
                <ul class="nav">
                    <li><a href="index.html">Home</a></li>
                    <li><a class="active" href="attendance.html">Attendance</a></li>
                    <li><a href="students.html">Students</a></li>
                    <li><a href="classes.html">Classes</a></li>
                    <li><a href="assignments.html">Assignments</a></li>
                    <li><a href="exams.html">Exams</a></li>
                    <li><a href="reports.html">Reports</a></li>
                    <li><a href="settings.html">Settings</a></li>
                </ul>
                <button id="toggleTheme" class="btn btn-sm btn-outline-light ms-auto">Dark</button>
            </div>

            <div class="content mt-3">
                <h1>Select Class & Section</h1>
                <form id="attendanceSelectForm" class="row g-2 mt-1">
                    <div class="col-12 col-md-3">
                        <label class="form-label">Date</label>
                        <input id="attendanceDate" type="date" class="form-control" value="" required>
                    </div>
                    <div class="col-12 col-md-3">
                        <label class="form-label">Class</label>
                        <select id="attendanceClass" class="form-select" required>
                            <option value="">Select Class</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-3">
                        <label class="form-label">Section</label>
                        <select id="attendanceSection" class="form-select" required>
                            <option value="">Select Section</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">Show Students</button>
                    </div>
                </form>
                <div class="table-card mt-4 d-none" id="studentsTableCard">
                    <h5 class="mb-3">Students in Selected Class & Section</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- Students will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <script>
        
        // Utility: load unique classes and sections from students in localStorage
        function populateClassSectionSelectors() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const classSet = new Set(students.map(s => s.className));
            const attendanceClass = document.getElementById('attendanceClass');
            attendanceClass.innerHTML = '<option value="">Select Class</option>';
            classSet.forEach(cls => {
                if(cls) attendanceClass.innerHTML += `<option value="${cls}">${cls}</option>`;
            });

            attendanceClass.addEventListener('change', function() {
                const selectedClass = this.value;
                const sectionSet = new Set(students.filter(s => s.className === selectedClass).map(s => s.section));
                const attendanceSection = document.getElementById('attendanceSection');
                attendanceSection.innerHTML = '<option value="">Select Section</option>';
                sectionSet.forEach(sec => {
                    if(sec) attendanceSection.innerHTML += `<option value="${sec}">${sec}</option>`;
                });
            });
        }

        // On form submit, display students table for selected class/section
        document.addEventListener('DOMContentLoaded', function() {
            populateClassSectionSelectors();
            // Default date to today
            const dateInput = document.getElementById('attendanceDate');
            if(dateInput && !dateInput.value) dateInput.value = new Date().toISOString().split('T')[0];

            document.getElementById('attendanceSelectForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const cls = document.getElementById('attendanceClass').value;
                const sec = document.getElementById('attendanceSection').value;
                const tbody = document.getElementById('attendanceTableBody');
                const tableCard = document.getElementById('studentsTableCard');
                if(!cls || !sec) { alert('Please select class and section.'); return; }
                const students = JSON.parse(localStorage.getItem('students') || '[]');
                const filtered = students.filter(s => s.className === cls && s.section === sec);
                if(filtered.length === 0){
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No students found for this class/section</td></tr>';
                } else {
                    tbody.innerHTML = filtered.map((s, idx) => 
                        `<tr>
                            <td>${idx+1}</td>
                            <td>${s.id || ''}</td>
                            <td>${s.name}</td>
                            <td>
                                <select class="form-select form-select-sm attendance-status">
                                    <option value="Present">Present</option>
                                    <option value="Absent">Absent</option>
                                    <option value="Late">Late</option>
                                    <option value="Excused">Excused</option>
                                </select>
                            </td>
                        </tr>`
                    ).join('');
                }
                tableCard.classList.remove('d-none');
            });
        });

        function loadStudents() {
    const stored = localStorage.getItem('students');
    if (stored) {
        try {
            return JSON.parse(stored);
        } catch (e) {
            return [];
        }
    }
    return [];
}

// --- Populate Class and Section selects based on saved students ---
function populateClassAndSectionSelects() {
    const students = loadStudents();

    // Get all unique classes
    const classes = Array.from(new Set(students.map(s => s.class))).filter(Boolean).sort();
    // Get all unique sections
    const sections = Array.from(new Set(students.map(s => s.section))).filter(Boolean).sort();

    // Populate class select
    const classSelect = document.getElementById('attendanceClass');
    classSelect.innerHTML = '<option value="">Select Class</option>';
    classes.forEach(cls => {
        const option = document.createElement('option');
        option.value = cls;
        option.textContent = cls;
        classSelect.appendChild(option);
    });

    // Populate section select
    const sectionSelect = document.getElementById('attendanceSection');
    sectionSelect.innerHTML = '<option value="">Select Section</option>';
    sections.forEach(sec => {
        const option = document.createElement('option');
        option.value = sec;
        option.textContent = sec;
        sectionSelect.appendChild(option);
    });
}

// Run on page load
document.addEventListener('DOMContentLoaded', function() {
    populateClassAndSectionSelects();
});
        </script>
        <script src="scripts.js"></script>
        
    </body>
</html>